<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scenarios</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="styles/editor.css">
</head>

<body>
    <nav class="editor-header navbar navbar-expand-lg navbar-light px-5 py-2">
        <!-- <a class="navbar-brand" href="#">Logo or something</a> -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </nav>

    <div class="py-4 px-3 w-100">
        <div class="d-flex justify-content-between col-12">
            <div class="col-6 d-flex justify-content-start">
                <h2>Scenarios</h2>
                <a class="ms-4 btn btn-primary px-4 rounded-pill" href="/scenario/scenario_configuration?level=1"
                    id="add-scenario">Add</a>
            </div>
            <select class="w-25 form-select" id="level-selection">
                <option value="1">Level 1</option>
                <option value="2">Level 2</option>
                <option value="3">Level 3</option>
                <option value="4">Level 4</option>
                <option value="5">Level 5</option>
            </select>
        </div>
        <div class="d-flex justify-content-center flex-wrap mt-4 mx-4" id="scenarios">
        </div>
        <p class="col-12 lead w-100 text-center mt-5 d-none" id="no-scenario">———— &nbsp;&nbsp; No scenarios available
            &nbsp;&nbsp; ————</p>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

        <script>
            async function fetchScenarios() {
                console.log("hihi")
                try {
                    const response = await fetch('http://127.0.0.1:5000/scenario/');
                    if (!response.ok) {
                        throw new Error("Failed to fetch scenarios");
                    }

                    const scenarios = await response.json();

                    // Log the scenarios to check
                    console.log(scenarios);

                    // Example: Add them to a div
                    const container = document.getElementById('scenarios');
                    scenarios.forEach(scenario => {
                        const div = document.createElement('div');
                        div.classList.add(`levelClass`, `level-${scenario.level}`, `d-none`, 'card', 'mx-3', 'mb-4');
                        div.style.width = "300px";

                        div.innerHTML = 
                        `<div class="card-body">` +
                        `<img src="page_photo/${scenario.image}" class="w-100 mb-2" alt="Scenario Image">` +
                        `<h5 class="card-title">Scenario: ${scenario.name}</h5>` +
                        `<p class="card-text">${scenario.description}</p>` +
                        `<a href="http://127.0.0.1:5000/scenario/scenario_configuration?id=${scenario.id}" class="btn btn-primary">Edit</a>` +
                        `</div>`;

                        container.appendChild(div);
                    });

                    $(".levelClass").each(function () {
                        if ($(this).hasClass("level-1")) {
                            $(this).removeClass("d-none")
                        }
                    })

                } catch (error) {
                    console.error("Error fetching scenarios:", error);
                }
            }

            $(document).ready(function () {
                $("#level-selection").on("change", function () {
                    let count = 0
                    let level_value = $(this).val()
                    $("#no-scenario").addClass("d-none")
                    var newHref = "/scenario/scenario_configuration?level=" + level_value;
                    $('#add-scenario').attr('href', newHref);

                    $(".card").each(function () {
                        if (!$(this).hasClass("level-" + level_value) && !$(this).hasClass("d-none")) {
                            $(this).addClass("d-none")
                            console.log($(this))
                        }
                        else if ($(this).hasClass("level-" + level_value)) {
                            count = count + 1
                            $(this).removeClass("d-none")
                        }
                    })

                    if (count == 0) {
                        $("#no-scenario").removeClass("d-none")
                    }
                })

                fetchScenarios();

            });
        </script>
</body>

</html>